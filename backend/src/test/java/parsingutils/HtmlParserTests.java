package parsingutils;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import de.techfak.gse.template.parsingutils.HtmlParser;
import de.techfak.gse.template.parsingutils.JsonParser;
import de.techfak.gse.template.parsingutils.TreeNode;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.stream.Collectors;

import static org.assertj.core.api.Assertions.assertThat;

public class HtmlParserTests {

    public JsonNode root;

    public String correctTestText = """
            <section data-style="summary">\n<p style="color: #252525;">Grundprüfungsschema für das vorsätzliche vollendete Begehungsdelikt (§ 15 Var. 1 StGB) mit den wichtigsten Prüfungspunkten und Problemen innerhalb des objektiven und subjektiven Tatbestandes, der Rechtswidrigkeit und der Schuld.</p>\n</section>\n<p style="color: #252525;" data-style="standard"> </p>\n<ol id="tableOfContents" contenteditable="false">\n<li data-style="heading1">Inhaltsverzeichnis</li>\n<li style="margin: 0rem 0rem 0rem 1.35rem;" data-style="heading3">Tatbestand</li>\n<li style="margin: 0rem 0rem 0rem 2.7rem;" data-style="heading4">Objektiver Tatbestand</li>\n<li style="margin: 0rem 0rem 0rem 4.05rem;" data-style="heading5">Tatsubjekt / Täter</li>\n<li style="margin: 0rem 0rem 0rem 4.05rem;" data-style="heading5">Tathandlung</li>\n<li style="margin: 0rem 0rem 0rem 4.05rem;" data-style="heading5">Erfolgseintritt (bei Erfolgsdelikten)</li>\n<li style="margin: 0rem 0rem 0rem 4.05rem;" data-style="heading5">Kausalität zwischen Handlung und Erfolg</li>\n<li style="margin: 0rem 0rem 0rem 4.05rem;" data-style="heading5">Objektive Zurechnung</li>\n<li style="margin: 0rem 0rem 0rem 5.4rem;" data-style="heading6">Gefahrschaffung</li>\n<li style="margin: 0rem 0rem 0rem 5.4rem;" data-style="heading6">Risikozusammenhang</li>\n<li style="margin: 0rem 0rem 0rem 2.7rem;" data-style="heading4">Subjektiver Tatbestand</li>\n<li style="margin: 0rem 0rem 0rem 4.05rem;" data-style="heading5">Vorsatz bzgl. der objektiven Tatbestandsmerkmale (§ 15 Var. 1 StGB)</li>\n<li style="margin: 0rem 0rem 0rem 4.05rem;" data-style="heading5">Sonstige subjektive Tatbestandsmerkmale</li>\n<li style="margin: 0rem 0rem 0rem 1.35rem;" data-style="heading3">Rechtswidrigkeit</li>\n<li style="margin: 0rem 0rem 0rem 1.35rem;" data-style="heading3">Schuld</li>\n<li style="margin: 0rem 0rem 0rem 1.35rem;" data-style="heading3">Regelbeispiele / Strafzumessungsregeln</li>\n<li style="margin: 0rem 0rem 0rem 1.35rem;" data-style="heading3">Sonstige Strafbarkeitsvoraussetzungen</li>\n</ol>\n<p data-style="paragraph"> </p>\n<p data-style="standard">Für <a href="https://lexmea.de/gesetz/stgb/15/grundschema_fahrlassiges_begehungsdelikt" title="Grundschema: Fahrlässiges Begehungsdelikt (§ 15 Var. 2 StGB)" rel="nofollow noreferrer">Fahrlässigkeitsdelikte</a>, <a href="https://lexmea.de/gesetz/stgb/13/grundschema_vorsatzliches_unechtes_unterlassungsdelikt" title="Grundschema: Vorsätzliches unechtes Unterlassungsdelikt (§ 13 StGB)" rel="nofollow noreferrer">unechte Unterlassungsdelikte</a> und <a href="https://lexmea.de/gesetz/stgb/22/grundschema_versuch_des_vorsatzlichen_begehungsdelikts" title="Grundschema: Versuch des vorsätzlichen Begehungsdelikts (§§ 22, 23 StGB)" rel="nofollow noreferrer">Versuch</a>, siehe die jeweils besonderen Prüfungsschemata.</p>\n<p data-style="standard"> </p>\n<section data-style="structure_note">\n<p data-style="paragraph"><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Der Aufbau soll aus sich heraus verständlich sein und wird nicht erklärt. </span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Inzidentprüfungen</span></span><span class="apple-converted-space"><span style="color: black; mso-color-alt: windowtext;"> sind zu </span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">vermeiden.</span></span></p>\n<ul style="list-style-type: square;">\n<li class="Aufbauhinweis">\n<p data-style="standard"><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;"><strong>Bildung von Tatkomplexen</strong><br></span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Erleichtert Zuordnung; Benennung nach Handlungen und nicht nach Delikten („Schüsse auf O“ statt „Mord an O“).</span></span></p>\n</li>\n<li class="Aufbauhinweis">\n<p data-style="standard"><strong><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Bei mehreren</span></span><span class="apple-converted-space"><span style="color: black; mso-color-alt: windowtext;"> </span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Beteiligten</span></span></strong><span class="apple-converted-space"><span style="color: black; mso-color-alt: windowtext;"><br></span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Täter vor Teilnehmer</span></span><span class="apple-converted-space"><span style="color: black; mso-color-alt: windowtext;">; M</span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">it Tatnächstem beginnen; Tatmittler vor mittelbarem Täter; Einzeltäter vor Mittäter; Bei gemeinschaftlichem Handeln können Mittäter gemeinsam geprüft werden, wobei aber jedenfalls Vorsatz und Schuld individuell zu prüfen sind.</span></span></p>\n</li>\n<li class="Aufbauhinweis">\n<p data-style="standard"><strong><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Bei mehreren</span></span><span class="apple-converted-space"><span style="color: black; mso-color-alt: windowtext;"> </span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Delikten</span></span></strong><span class="apple-converted-space"><span style="color: black; mso-color-alt: windowtext;"><strong> </strong><br></span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Alle in Betracht kommenden Delikte anprüfen; </span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">grds. nach Schwere der Straftat ordnen („Dickschiffe voran!“); Tun vor Unterlassen; Unechte Unterlassungsdelikte vor echten Unterlassungsdelikten; Vorsatzdelikte vor entsprechenden Fahrlässigkeitsdelikten; vollendetes Delikt vor Versuch; </span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Anstiftung vor Beihilfe</span></span></p>\n</li>\n<li class="Aufbauhinweis"><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;"><strong>Bei Grundtatbestand, Qualifikation und Erfolgsqualifikation</strong><br></span></span><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;">Nie alle drei gemeinsam prüfen.</span></span>\n<ul>\n<li class="Aufbauhinweis"><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;"><strong>Wenn nur Grundtatbestand erfüllt</strong><br>Zunächst Grundtatbestand einzeln prüfen und nicht gleich mit (Erfolgs-) Qualifikation zusammen, da unterschiedliche Ergebnisse festgehalten werden („X hat sich / hat sich nicht nach §… strafbar gemacht“.) Bei der anschließenden Prüfung der (Erfolgs-)Qualifikation wird dann zu Beginn zunächst kurz auf das erfüllte Grunddelikt verwiesen. </span></span></li>\n<li class="Aufbauhinweis"><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;"><strong>Wenn Grundtatbestand + Erfolgsqualifikation erfüllt</strong><br>Aufgrund der unterschiedlichen subjektiven Voraussetzungen (Vorsatz / Fahrlässigkeit) empfiehlt es sich auch hier zunächst das Grunddelikt und anschließend separat die Erfolgsqualifikation zu prüfen und dabei kurz auf das erfüllte Grunddelikt zu verweisen.</span></span></li>\n<li class="Aufbauhinweis"><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;"><strong>Wenn Grundtatbestand + Qualifikation erfüllt<br></strong>Im Tatbestand können jeweils hintereinander zunächst die objektiven und subjektiven Merkmale des Grunddeliktes und dann der Qualifikation geprüft werden. Bei besonders komplexen Delikten empfiehlt sich ggf. ebenfalls eine getrennte Prüfung.</span></span></li>\n</ul>\n</li>\n</ul>\n</section>\n<p data-style="standard"><span class="normaltextrun"><span style="color: black; mso-color-alt: windowtext;"><span style="mso-spacerun: yes;"> </span></span></span></p>\n<h2 data-style="heading3">Tatbestand</h2>\n<h3 data-style="heading4">Objektiver Tatbestand</h3>\n<h4 data-style="heading5">Tatsubjekt / Täter</h4>\n<p><!-- [if !supportLists]--><!--[endif]-->Bei echten Sonderdelikten begrenzter Täterkreis <br><em>Beispiel: Amtsträger (</em><em>§§ 331 ff. StGB i.V.m. </em><em>§ 11 I Nr. 2 StGB)</em></p>\n<p> </p>\n<h4 class="MsoNormal" data-style="heading5"><span style="mso-fareast-language: DE;">Tathandlung</span></h4>\n<section data-style="definition">\n<p class="Definition" data-style="standard"><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;"><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Tathandlung =</span></em></strong><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"> Der Außenwelt erkennbares, willensgetragenes menschliches Verhalten (Tun oder Unterlassen)</span></p>\n</section>\n<ul style="list-style-type: square;">\n<li class="Liste1CxSpFirst"><!-- [if !supportLists]--><!--[endif]-->Noch willensgetragen: automatisiertes Verhalten, Affekttaten, Spontanhandlungen, Kurzschlussreaktionen.</li>\n<li class="Liste1CxSpMiddle"><!-- [if !supportLists]--><!--[endif]-->Nicht mehr willensgetragen: Reflexe, Instinkthandlungen, Bewegungen in der Bewusstlosigkeit oder im Schlaf.</li>\n<li class="Liste1CxSpLast"><!-- [if !supportLists]--><!--[endif]-->Abgrenzung Tun / Unterlassen gem. h.M. nach Schwerpunkt der Vorwerfbarkeit.</li>\n</ul>\n<p class="MsoNormal"> </p>\n<h4 data-style="heading5">Erfolgseintritt (bei Erfolgsdelikten)</h4>\n<p class="MsoNormal" data-style="standard"><em style="mso-bidi-font-style: normal;"><span style="mso-fareast-language: DE;">Beispiele:</span> <a href="https://lexmea.de/gesetz/stgb/223/korperverletzung" title="Körperverletzung (§ 223 StGB)" rel="nofollow noreferrer">Gesundheitsschädigung (§ 223 I StGB)</a>; <a href="https://lexmea.de/gesetz/stgb/212/totschlag" title="Totschlag (§ 212 StGB)" rel="nofollow noreferrer">Tod eines Menschen (§ 212 I StGB)</a>; <a href="https://lexmea.de/gesetz/stgb/315c/gefahrdung_des_strassenverkehrs" title="Gefährdung des Straßenverkehrs (§ 315c StGB)" rel="nofollow noreferrer">konkrete Verkehrsgefährdung (§ 315c StGB)</a></em></p>\n<p> </p>\n<h4 data-style="heading5">Kausalität zwischen Handlung und Erfolg</h4>\n<section data-style="definition">\n<p class="Definition"><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;"><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Kausal =</span></em></strong><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"> Jede Bedingung, die nicht hinweggedacht werden kann, ohne dass der Erfolg in seiner konkreten Gestalt entfiele (Äquivalenztheorie / <em style="mso-bidi-font-style: normal;">conditio-sine-qua-non</em>-Formel).</span></p>\n<p class="Definition" data-style="standard"><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Ergänzungssatz für Fälle alternativer Kausalität: Von mehreren Bedingungen, die alternativ, nicht aber kumulativ hinweggedacht werden können, ist jede kausal.</span></p>\n</section>\n<p class="Definition" data-style="standard"> </p>\n<section data-style="problem">\n<p class="Problem"><strong style="mso-bidi-font-weight: normal;"><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Außergewöhnliche Kausalverläufe</span></strong></p>\n<ul style="list-style-type: square;">\n<li class="Problem">\n<p data-style="standard"><strong style="mso-bidi-font-weight: normal;"><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Kumulative Kausalität <br></span></strong><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Mehrere Handlungen, die alleine betrachtet nicht zum Erfolg führen würden, von denen jedoch keine hinweggedacht werden kann, ohne dass der Erfolg entfiele.<br><em style="mso-bidi-font-style: normal;">Beispiel:</em></span><em style="mso-bidi-font-style: normal;"><span style="color: black; mso-color-alt: windowtext;"> Zwei Personen verabreichen jeweils eine halbe Dosis tödlichen Giftes</span></em><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"><br></span><span style="font-family: 'MS Mincho'; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">→</span><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"> Jede Einzelhandlung ist kausal</span></p>\n</li>\n<li class="Problem">\n<p data-style="standard"><strong style="mso-bidi-font-weight: normal;"><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Alternative Kausalität <br></span></strong><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Mehrere Handlungen, die alleine betrachtet zum Erfolg führen, von denen also eine hinweggedacht werden kann, ohne dass der Erfolg entfiele.<br><em style="mso-bidi-font-style: normal;">Beispiele:</em></span><em style="mso-bidi-font-style: normal;"><span style="color: black; mso-color-alt: windowtext;"> Drei Personen verabreichen jeweils eine volle tödliche Dosis; zehn Schützen eines Erschießungskommandos geben einen tödlichen Schuss ab; alle fünf abstimmungsberechtigten Gremienmitglieder stimmen für die Erteilung des Schießbefehls</span></em><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"><br></span><span style="font-family: 'MS Mincho'; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">→</span><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"> Korrektur der <em>sine-qua-non-Formel</em> notwendig </span><span style="font-family: 'MS Mincho'; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">→</span><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"> auch hier ist jede von mehreren Einzelhandlungen kausal, die zwar alleine, nicht jedoch gemeinsam mit allen anderen hinweggedacht werden kann, ohne dass der Erfolg entfiele (aber ggf. Korrektur auf Ebene der objektiven Zurechnung, wenn die drei Personen nichts voneinander wissen, s.u.)</span></p>\n</li>\n<li class="Problem">\n<p data-style="standard"><strong style="mso-bidi-font-weight: normal;"><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Abgebrochene / Überholende Kausalität<br></span></strong><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Durch ein Dazwischentreten des Ausgangsstörers, des Opfers oder eines Dritten kann die Kausalkette gänzlich abgebrochen und eine überholende neue gestartet werden.<strong style="mso-bidi-font-weight: normal;"><br></strong><em style="mso-bidi-font-style: normal;">Beispiel:</em></span><em style="mso-bidi-font-style: normal;"><span style="color: black; mso-color-alt: windowtext;"> A gibt B Gift. C erschießt B bevor dieses wirkt.</span></em><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"><br></span><span style="font-family: 'MS Mincho'; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">→</span><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"> Alte Einzelhandlung ist nicht kausal (aber: Versuch)<strong style="mso-bidi-font-weight: normal;"><br></strong>Nicht abgebrochen, sondern weiterwirkend ist die alte Handlung hingegen, wenn sie ihrerseits sine-qua-non für eine neue dazwischentretende Handlung ist.<br><em style="mso-bidi-font-style: normal;">Beispiel:</em></span><em style="mso-bidi-font-style: normal;"><span style="color: black; mso-color-alt: windowtext;"> A gibt B Gift. B stirbt auf dem Weg ins Krankenhaus bei einem Unfall. Hier war das Verabreichen des Giftes sine-qua-non für die Krankenhausfahrt.</span></em><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"><br></span><span style="font-family: 'MS Mincho'; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">→ </span><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Kausalität wird nicht abgebrochen (ggf. Korrektur auf Ebene der objektiven Zurechnung, s.u.)</span></p>\n</li>\n</ul>\n</section>\n<p data-style="standard"> </p>\n<h4 data-style="heading5">Objektive Zurechnung</h4>\n<section data-style="structure_note">\n<p class="Aufbauhinweis" style="margin-left: 0cm;" data-style="standard"><span style="color: black; mso-color-alt: windowtext;">Aufbau entspricht h.L.; BGH prüft objektive Zurechnung nur bei Fahrlässigkeitsdelikten und grenzt ansonsten im Vorsatz ab: Zurechnung, wenn sich Abweichung zwischen der Vorstellung des Täters und dem tatsächlichen Tatverlauf in den Grenzen allgemeiner Lebenserfahrung bewegt und keine andere Bewertung der Tat rechtfertigt.</span></p>\n</section>\n<section data-style="definition">\n<p class="Definition"><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;"><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Objektive Zurechnung =</span></em></strong><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;"> Schaffung einer rechtlich missbilligten Gefahr (Gefahrschaffung), die sich im tatbestandsmäßigen Erfolg realisiert hat (Risikozusammenhang)</span></p>\n</section>\n<p data-style="standard"> </p>\n<h5 data-style="heading6">Gefahrschaffung</h5>\n<p class="MsoNormal">Der Täter muss eine durch die Rechtsordnung insgesamt missbilligte Gefahr schaffen.</p>\n<ul style="list-style-type: square;">\n<li data-style="standard"><strong style="mso-bidi-font-weight: normal;">Nicht bei sozialadäquatem oder erlaubtem Risiko<br></strong>Verhalten wird gesellschaftlich toleriert oder hält sich im Rahmen des allgemeinen Lebensrisikos.<br><em style="mso-bidi-font-style: normal;">Beispiele: Autofahren; A überredet B zu einer Reise mit dem Flugzeug, das wie erhofft abstürzt; A bringt B zur Welt (der vierzig Jahre später C ermordet).</em></li>\n</ul>\n<ul style="list-style-type: square;">\n<li class="MsoNormal">\n<p data-style="standard"><strong style="mso-bidi-font-weight: normal;">Nicht bei Risikoverringerung<br></strong>Rechtsgutverletzung wird durch die Tathandlung verringert oder verzögert.<br><em style="mso-bidi-font-style: normal;">Beispiel: A lenkt den Schlag des B auf den C ab, sodass C lediglich am Arm und nicht am Kopf getroffen wird.</em></p>\n</li>\n</ul>\n<p data-style="standard"> </p>\n<h5 data-style="heading6">Risikozusammenhang</h5>\n<p class="MsoNormal"><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Gerade die rechtlich missbilligte Gefahr muss sich im tatbestandsmäßigen Erfolg realisiert haben (Risikozusammenhang). </span></p>\n<p class="MsoNormal" data-style="standard"><span style="color: black; mso-color-alt: windowtext; mso-fareast-language: DE;">Zu dieser Bestimmung haben sich folgende Kategorien herausgebildet:<br></span></p>\n<ul style="list-style-type: square;">\n<li class="MsoNormal">\n<p data-style="standard"><strong style="mso-bidi-font-weight: normal;">Schutzzweck der Norm<br></strong>Im Erfolg hat sich nicht das vom Schutzzweck der Norm missbilligte Risiko verwirklicht.<br><em style="mso-bidi-font-style: normal;">Beispiel: A missachtet eine rote Ampel und überfährt erst 2 km weiter, unter Einhaltung der Verkehrsregeln  B (die rote Ampel schützt nicht davor, dass A zu einer bestimmten Zeit an einem bestimmten Ort fährt).</em></p>\n</li>\n<li class="MsoNormal">\n<p data-style="standard"><strong style="mso-bidi-font-weight: normal;">Nicht bei völlig atypischen Kausalverläufen oder geringer Wahrscheinlichkeit (str.)<br></strong>Erfolg liegt völlig außerhalb dessen, was nach dem gewöhnlichen Lauf der Dinge und nach allgemeiner Lebenserfahrung zu erwarten war. (Im Falle nur geringer Abweichungen ggf. kein Vorsatz bzgl. Kausalverlauf, s.u.).<br><em style="mso-bidi-font-style: normal;">Beispiel: A tritt B auf den Fuß, wodurch sich ein Blutgerinnsel löst, das zu einem tödlichen Schlaganfall führt; teilweise wird auch der o.g. Fall, in dem A den B zu einer Reise im später abstürzenden Flugzeug überredet, hier eingeordnet.</em></p>\n</li>\n<li class="MsoNormal">\n<p data-style="standard"><strong style="mso-bidi-font-weight: normal;">Nicht bei eigenverantwortlichem Dazwischentreten Dritter<br></strong>Ein Dritter muss vorsätzlich (a.A.: voll eigenverantwortlich = mindestens grob fahrlässig) eine auf den Erfolg hinwirkende Gefahr begründen.<br><em style="mso-bidi-font-style: normal;">Beispiel: A gibt B Gift. B wird im Krankenhaus von C erstickt.<br></em>Aber: Das geschaffene Risiko oder Dazwischentreten darf nicht bereits in der Tathandlung angelegt sein.<br><em style="mso-bidi-font-style: normal;">Beispiel: A zündet ein Haus an. Feuerwehrmann C kommt voll eigenverantwortlich zur Hilfe und stirbt dabei.</em></p>\n</li>\n<li class="MsoNormal"><strong style="mso-bidi-font-weight: normal;">Nicht bei freiverantwortlicher Selbstgefährdung oder einverständlicher Fremdgefährdung</strong></li>\n</ul>\n<ul>\n<li style="list-style-type: none;">\n<ul>\n<li class="MsoNormal"><strong style="mso-bidi-font-weight: normal;">Freiverantwortliche Selbstgefährdung (oder -schädigung)<br></strong>Tatherrschaft liegt beim <em style="mso-bidi-font-style: normal;">Opfer</em> und nicht beim Täter. Aber keine objektive Zurechnung, sofern sich die Mitwirkung des lediglich in Veranlassung, Ermöglichung oder Förderung der freiverantwortlichen Selbstgefährdung erschöpft. Freiverantwortlichkeit bedeutet nach.\n<ul style="list-style-type: circle;">\n<li class="MsoNormal"><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">e.A. (Exkulpationslösung)<br></em></strong>Freiverantwortlichkeit nur nicht, wenn eine der Exkulpationsregelungen analog greift (z.B. Kinder § 19 StGB; psychisch Kranke, § 20 StGB; Menschen in einer Notlage gem. § 35 StGB; Jugendliche ohne die Einsichtsfähigkeit nach § 3 JGG).</li>\n<li class="MsoNormal"><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">h.M. (Einwilligungslösung; strenger)<br></em></strong>Freiverantwortlichkeit nur, wenn das Opfer „ernstlich“ einwilligt und sich der Tragweite des Entschlusses voll bewusst ist; bereits nicht bei Trunkenheit, Depression, Täuschung, Drohung, Irrtum, überlegenem Wissen, Jugendlichkeit u. dergl.</li>\n</ul>\n</li>\n<li class="MsoNormal"><strong style="mso-bidi-font-weight: normal;">Einverständliche Fremdgefährdung (oder -schädigung)<br></strong>Tatherrschaft liegt beim <em style="mso-bidi-font-style: normal;">Täter</em> und nicht beim Opfer. Behandlung umstritten:\n<ul style="list-style-type: circle;">\n<li class="MsoNormal"><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">e.A.:</em></strong> Keine objektive Zurechnung, wenn beide das Risiko gleich gut überschauen können (sodass Strafbarkeit ausscheidet).</li>\n<li class="MsoNormal"><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">a.A.:</em></strong> Objektive Zurechnung gegeben, aber ggf. tatbestandsausschließendes Einverständnis oder rechtfertigende Einwilligung (aber: hier Grenzen insb. d. §§ 216, 228 StGB, sodass i.d.R. eine Strafbarkeit zu bejahen ist).</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p> </p>\n<p data-style="standard"> </p>\n<h3 data-style="heading4"><!--[endif]-->Subjektiver Tatbestand</h3>\n<p data-style="standard"><span style="mso-fareast-language: DE;">Ausführlich hierzu die <a href="https://lexmea.de/gesetz/stgb/15/ubersicht_vorsatz_und_fahrlassigkeit" title="Übersicht: Vorsatz und Fahrlässigkeit" rel="nofollow noreferrer">Übersicht: Vorsatz und Fahrlässigkeit</a> bei § 15 StGB.</span></p>\n<h4 data-style="heading5"><!-- [if !supportLists]-->Vorsatz bzgl. der objektiven Tatbestandsmerkmale (§ 15 Var. 1 StGB)</h4>\n<section data-style="definition">\n<p class="Definition"><strong><em><span style="color: black; mso-color-alt: windowtext;">Vorsatz =</span></em></strong><span style="color: black; mso-color-alt: windowtext;"> Wille zur Verwirklichung des Tatbestandes (voluntatives Element) in Kenntnis seiner Merkmale (kognitives Element)</span></p>\n</section>\n<ul style="list-style-type: square;">\n<li class="Liste1CxSpFirst"><!-- [if !supportLists]--><!--[endif]--><strong style="mso-bidi-font-weight: normal;">Absicht (dolus directus 1. Grades)<br></strong>Täter will Erfolgseintritt &amp; hält ihn für zumindest möglich.</li>\n</ul>\n<p> </p>\n<ul style="list-style-type: square;">\n<li class="Liste1CxSpMiddle"><!-- [if !supportLists]--><!--[endif]--><strong style="mso-bidi-font-weight: normal;">Wissentlichkeit (dolus directus 2. Grades)<br></strong>Täter weiß um Erfolgseintritt oder sieht diesen sicher voraus (&amp; es ist unerheblich, ob er ihn will oder nicht).</li>\n</ul>\n<p> </p>\n<ul style="list-style-type: square;">\n<li class="Liste1CxSpLast"><!-- [if !supportLists]--><!--[endif]--><strong style="mso-bidi-font-weight: normal;">Bedingter Vorsatz / Eventualvorsatz (dolus eventualis)</strong></li>\n</ul>\n<ul>\n<li style="list-style-type: none;">\n<ul>\n<li class="Liste1CxSpLast"><!-- [if !supportLists]--><!--[endif]--><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">e.A. Möglichkeitstheorie<br></em></strong>Täter hält Erfolgseintritt für möglich.</li>\n<li class="Liste1CxSpLast"><!-- [if !supportLists]--><!--[endif]--><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">a.A. Wahrscheinlichkeitstheorie</em></strong> <br>Täter hält Erfolgseintritt für wahrscheinlich.</li>\n<li class="Liste1CxSpLast"><!-- [if !supportLists]--><!--[endif]--><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">a.A. Gleichgültigkeitstheorie<br></em></strong>Täter nimmt die Tatbestandsverwirklichung aus Gleichgültigkeit gegenüber dem Rechtsgut billigend in Kauf.</li>\n<li class="Liste1CxSpLast"><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">Rspr. Billigungstheorie<br></em></strong>Täter hält den Erfolgseintritt für möglich und nimmt ihn billigend in Kauf. („Und wenn schon.“)</li>\n</ul>\n</li>\n</ul>\n<p> </p>\n<ul style="list-style-type: square;">\n<li class="Liste1CxSpFirst"><!--[endif]--><strong style="mso-bidi-font-weight: normal;">Irrtum über den Kausalverlauf<br></strong>Es genügt, wenn der Täter den Kausalverlauf in seinen wesentlichen Zügen erfasst. Unwesentliche Abweichungen sind daher irrelevant.</li>\n</ul>\n<ul>\n<li style="list-style-type: none;">\n<ul>\n<li class="Liste2CxSpFirst"><!-- [if !supportLists]--><!--[endif]--><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">Rspr.:</em></strong> Wesentliche Abweichungen des tatsächlichen vom vorgestellten Kausalverlauf lassen den Vorsatz entfallen. Wesentlich ist eine Abweichung, wenn mit dem konkreten Ablauf nach allgemeiner Lebenserfahrung nicht gerechnet werden musste oder dieser wertungsmäßig nicht mehr zum ursprünglichen Tatplan passt. (Dann i.d.R. versuchtes Vorsatzdelikt bzgl. Vorstellung + ggf. Fahrlässigkeitsdelikt bzgl. tatsächlichem Ablauf).</li>\n<li class="Liste2CxSpFirst"><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">a.A:</em></strong> Anerkennung eines „dolus generalis“, der auch wesentlich abweichende Kausalverläufe umfasst (dann vollendetes Vorsatzdelikt).</li>\n</ul>\n</li>\n</ul>\n<p> </p>\n<ul style="list-style-type: square;">\n<li class="Liste1CxSpFirst"><!--[endif]--><strong style="mso-bidi-font-weight: normal;">Tatbestandsirrtum auf rechtlicher Seite (§ 16 StGB)<br></strong>Täter muss keine gesetzlichen Definitionen können, sondern lediglich den rechtlich-sozialen Bedeutungsgehalt des Merkmals nach Laienart einigermaßen erfassen (‚Parallelwertung in der Laiensphäre‘).\n<ul>\n<li class="Liste1CxSpFirst"><em>Beispiel 1: Gebürtiger Deutscher wirft Bierdeckel mit Strichen weg <span lang="JA" style="font-family: 'MS Mincho'; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">→</span> <span class="normaltextrun">(+) </span>Strafbarkeit, da er zwar nicht die Definition einer „Urkunde“ i.S.d. § 274 StGB kennt, aber die grundsätzliche Beweisfunktion des Bierdeckels</em></li>\n<li class="Liste1CxSpFirst"><em>Beispiel: Frisch zugezogener Ausländer aus anderem Kulturkreis wirft Bierdeckel mit Strichen weg <span lang="JA" style="font-family: 'MS Mincho'; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">→</span> (–) Strafbarkeit, sofern er auch in der Laiensphäre die Bedeutung des Bierdeckels nicht kennt.</em></li>\n</ul>\n</li>\n</ul>\n<p> </p>\n<ul style="list-style-type: square;">\n<li class="Liste1"><!-- [if !supportLists]--><!--[endif]--><strong style="mso-bidi-font-weight: normal;">Tatbestandsirrtum auf Seiten des Sachverhaltes</strong></li>\n</ul>\n<ul>\n<li style="list-style-type: none;">\n<ul>\n<li class="Liste2CxSpFirst"><!-- [if !supportLists]--><span style="color: #000000;"><strong style="mso-bidi-font-weight: normal;"><em>Error in persona</em></strong></span><span style="color: #000000;"><span class="MsoCommentReference"><strong style="mso-bidi-font-weight: normal;"><span style="font-size: 8.0pt;"><!-- [if !supportAnnotations]--><!--[endif]--><span style="mso-special-character: comment;"> </span></span></strong></span><span style="mso-bidi-font-style: italic;"> (= anvisiertes Objekt wird getroffen, aber Irrtum über dessen Identität)</span>: Bei Gleichwertigkeit Vorsatz, bei Nicht-Gleichwertigkeit i.d.R. Fahrlässigkeit (h.M., str.).</span></li>\n<li class="Liste2CxSpFirst"><span style="color: #000000;"><strong style="mso-bidi-font-weight: normal;"><em style="mso-bidi-font-style: normal;">Aberratio ictus</em></strong><span class="MsoCommentReference"><strong style="mso-bidi-font-weight: normal;"><span style="font-size: 8.0pt;"><!-- [if !supportAnnotations]--><!--[endif]--><span style="mso-special-character: comment;"> </span></span></strong></span><strong style="mso-bidi-font-weight: normal;"> </strong>(</span>= anderes als anvisiertes Objekt wird getroffen)\n<ul style="list-style-type: circle;">\n<li class="Liste2CxSpFirst"><strong>e.A. Konkretisierungstheorie</strong><br>Versuch bzgl. anvisiertem und ggf. Fahrlässigkeit bzgl. getroffenem Objekt.</li>\n<li class="Liste2CxSpFirst"><strong>a.A. Gleichwertigkeitstheorie</strong><br>Versuch bzgl. anvisiertem und („Gattungs“)Vorsatz bzgl. getroffenem Objekt.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p> </p>\n<h4 data-style="heading5"><!-- [if !supportLists]-->Sonstige subjektive Tatbestandsmerkmale</h4>\n<p class="MsoNormal"><em style="mso-bidi-font-style: normal;"><span style="mso-fareast-language: DE;">Beispiele:</span></em><span style="mso-fareast-language: DE;"> </span><em style="mso-bidi-font-style: normal;">Zueignungsabsicht (§§ 242 I, 249 StGB), Bereicherungsabsicht (§§ 253, 259, 263 StGB)</em></p>\n<p class="MsoNormal"> </p>\n<p class="MsoNormal" data-style="standard"> </p>\n<h2 data-style="heading3"><!-- [if !supportLists]-->Rechtswidrigkeit</h2>\n<p class="MsoNormal">Die Rechtswidrigkeit wird <strong>durch die Tatbestandsmäßigkeit indiziert</strong>. Siehe für eine Übersicht der möglichen <strong>Rechtfertigungsgründe </strong>die <a href="https://lexmea.de/gesetz/stgb/19/ubersicht_rechtswidrigkeit_und_schuld_im_strafrecht" title="Übersicht: Rechtswidrigkeit und Schuld im Strafrecht" rel="nofollow noreferrer">Übersicht: Rechtswidrigkeit und Schuld im Strafrecht</a>.</p>\n<p> </p>\n<p data-style="standard"> </p>\n<h2 data-style="heading3"><!-- [if !supportLists]-->Schuld</h2>\n<p>Schuld bezeichnet die <strong>persönliche Vorwerfbarkeit </strong>der Unrechtsverwirklichung. Auch diese wird grundsätzlich angenommen. Siehe für Fälle, in denen sie entfällt (<strong>Schuldunfähigkeit</strong>, <strong>entschuldigende Irrtümer und Entschuldigungsgründe</strong>) die <a href="https://lexmea.de/gesetz/stgb/19/ubersicht_rechtswidrigkeit_und_schuld_im_strafrecht" title="Übersicht: Rechtswidrigkeit und Schuld im Strafrecht" rel="nofollow noreferrer">Übersicht: Rechtswidrigkeit und Schuld im Strafrecht</a>.</p>\n<p> </p>\n<p data-style="standard"> </p>\n<h2 data-style="heading3"><!-- [if !supportLists]-->Regelbeispiele / Strafzumessungsregeln</h2>\n<section data-style="structure_note">\n<p class="Aufbauhinweis"><span style="color: black; mso-color-alt: windowtext;">Regelbeispiele werden etwa im Unterschied zu Qualifikationen nicht im Tatbestand, sondern als IV. direkt nach der Schuld geprüft, da sie lediglich die Strafzumessung beeinflussen (daher auch: „Strafzumessungsregeln“). </span></p>\n</section>\n<ul style="list-style-type: square;">\n<li class="Liste1CxSpFirst"><!-- [if !supportLists]--><!--[endif]-->‚Besonders schwere Fälle‘ wirken sich strafschärfend aus, ‚minder schwere Fälle‘ strafmildernd.</li>\n<li class="Liste1CxSpLast"><!-- [if !supportLists]--><!--[endif]-->Regelbeispiele indizieren Vorliegen eines besonders schweren / minder schweren Falls (z.B. §§ 240 IV, 243, 263 III StGB), sind aber nicht abschließend und nicht zwingend.</li>\n</ul>\n<p> </p>\n<p> </p>\n<h2 data-style="heading3"><!-- [if !supportLists]-->Sonstige Strafbarkeitsvoraussetzungen</h2>\n<ul style="list-style-type: square;">\n<li class="Liste1CxSpFirst"><!-- [if !supportLists]--><!--[endif]-->\n<p data-style="standard"><strong>Strafantrag (§§ 77ff StGB)<br></strong><em style="mso-bidi-font-style: normal;">Beispiele: Hausfriedensbruch (§ 123 StGB), Körperverletzung (§ 230 StGB), Sachbeschädigung (§ 303c StGB)</em></p>\n</li>\n<li class="Liste1CxSpFirst">\n<p data-style="standard"><!-- [if !supportLists]--><!--[endif]--><strong>Persönliche Strafaufhebungsgründe<br></strong><em>Beispiele: Rücktritt vom Versuch (§ 24 StGB); Rücktritt vom Versuch der Beteiligung (§ 31 StGB)</em></p>\n</li>\n<li class="Liste1CxSpFirst">\n<p data-style="standard"><strong>Persönliche Strafausschließungsgründe</strong><br><em>Beispiele: Keine Strafbarkeit der Begünstigung der eigenen Person (§ 258 V StGB) oder von Angehörigen § 258 VI StGB); Selbstgeldwäsche (§ 261 VII StGB)<br></em></p>\n</li>\n</ul>\n<section data-style="structure_note">\n<ul style="list-style-type: square;">\n<li>\n<p data-style="standard"><strong>Strafausschließungsgründe </strong>liegen bereits <strong>zur Tatzeit</strong> vor.</p>\n</li>\n<li data-style="standard">\n<p data-style="standard"><strong>Strafaufhebungsgründe </strong>treten <strong>nachträglich </strong>ein.</p>\n</li>\n<li>\n<p data-style="standard">Sie führen beide zwar - wie beim Ausschluss des Tatbestandes ebenfalls - zur Straffreiheit des Täters. Es liegt jedoch - im Unterschied zum Ausschluss des Tatbestandes - <strong>weiterhin eine tatbestandsmäßige, rechtswidrige Haupttat</strong> vor, an der eine <strong>Teilnahme möglich</strong> ist.</p>\n</li>\n<li>Sie gelten beide nur für die Täter, bei denen sie persönlich vorliegen (<strong>§ 28 II StGB</strong>). Daher auch: 'persönliche' Strafaufhebungs- / Strafausschließungsgründe. </li>\n</ul>\n</section>\n<p data-style="standard"> </p>\n<p><!-- [if !supportAnnotations]--></p>\n<div style="mso-element: comment-list;"><!--[endif]--></div>
            """;

    public String html = """
            <!doctype html>
            <html>
              <head>
                <title>This is the title of the webpage!</title>
              </head>
              <body>
                <p>This is an example paragraph. Anything in the <strong>body</strong> tag will appear on the page, just like this <strong>p</strong> tag and its contents.</p>
              </body>
            </html>""";

    @BeforeEach
    void setUp() {
        try (
                InputStream is = JsonParserTests.class.getClassLoader().
                        getResourceAsStream("schemasWithFoLTree.json")) {
            assert is != null;
            try (BufferedReader br = new BufferedReader(new InputStreamReader(is))) {
                ObjectMapper mapper = new ObjectMapper();
                String jsonTxt = br.lines().collect(Collectors.joining());
                root = mapper.readTree(jsonTxt);
            } catch (Exception e) {
                throw new RuntimeException(e);
            }
        } catch (IOException e) {
            throw new RuntimeException(e);
        }
    }


    @Test
    void getTableOfContentsAsTreeTest() {
        /*ArrayList<Object> recursionPath = new ArrayList<>();
        ArrayList<ArrayList<Object>> allPaths = new ArrayList<>();
        JsonParser.findPathWithFieldAndValue(root, "type", "schema", recursionPath, allPaths);
        System.out.println("allPathsSize: " + allPaths.size());
        ArrayList<Object> path = allPaths.getFirst();
        ArrayList<String> schemaHtml = JsonParser.extractContentAsStringFromPath(root, path, "text");*/

        TreeNode<String> node1 = HtmlParser.getTableOfContentsAsTree(html);
        System.out.println(node1.hasOtherData());
        assertThat(node1.hasOtherData()).isFalse();

        TreeNode<String> node2 = HtmlParser.getTableOfContentsAsTree(correctTestText);
        System.out.println(node2.hasOtherData());
        assertThat(node2.hasOtherData()).isTrue();

        //TreeNode<String> node3 = HtmlParser.getTableOfContentsAsTree(html);
        //System.out.println(node3.hasOtherData());

    }

    /*@Test
    void getDefinitionBoxesTest() {
        ArrayList<String[]> definitionBoxes = HtmlParser.getDefinitionBoxes(html);
        System.out.println(definitionBoxes);
        assertThat(definitionBoxes.isEmpty()).isTrue();

        definitionBoxes = HtmlParser.getDefinitionBoxes(correctTestText);
        System.out.println(definitionBoxes);
        assertThat(definitionBoxes.size()).isEqualTo(4);
    }*/

    /*@Test
    void getProblemBoxesTest() {
        ArrayList<String[]> problemBoxes = HtmlParser.getProblemBoxes(html);
        System.out.println(problemBoxes);
        assertThat(problemBoxes.isEmpty()).isTrue();

        problemBoxes = HtmlParser.getProblemBoxes(correctTestText);
        //Lexmea lul
        System.out.println(problemBoxes);
        //assertThat(problemBoxes.size()).isEqualTo(4);
    }*/

}
